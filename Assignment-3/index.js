var V=Object.defineProperty;var z=(l,e,r)=>e in l?V(l,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):l[e]=r;var a=(l,e,r)=>(z(l,typeof e!="symbol"?e+"":e,r),r);import{W as E,S as q,P as N,C as B,V as C,M as L,a as H,b as T,c as U,G as F,d as A,e as v,T as k,L as W,F as M,f as D,g as x,h as u,i as f,j as G,D as K}from"./vendor.js";const O=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const t of s)if(t.type==="childList")for(const h of t.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&i(h)}).observe(document,{childList:!0,subtree:!0});function r(s){const t={};return s.integrity&&(t.integrity=s.integrity),s.referrerpolicy&&(t.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?t.credentials="include":s.crossorigin==="anonymous"?t.credentials="omit":t.credentials="same-origin",t}function i(s){if(s.ep)return;s.ep=!0;const t=r(s);fetch(s.href,t)}};O();class Q{constructor(e=60,r=1.333,i=1,s=1e3){a(this,"aspectRatio");a(this,"fov");a(this,"znear");a(this,"zfar");a(this,"renderer");a(this,"scene");a(this,"camera");a(this,"clock");this.fov=e,this.aspectRatio=r,this.znear=i,this.zfar=s,this.renderer=new E,this.renderer.setSize(window.innerWidth,window.innerHeight),document.body.appendChild(this.renderer.domElement),this.resize(),window.addEventListener("resize",()=>{this.resize()},!1),window.addEventListener("mousedown",t=>{this.onMouseDown(t)}),window.addEventListener("mouseup",t=>{this.onMouseUp(t)}),window.addEventListener("mousemove",t=>{this.onMouseMove(t)}),window.addEventListener("keydown",t=>{this.onKeyDown(t)}),window.addEventListener("keyup",t=>{this.onKeyUp(t)}),this.scene=new q,this.camera=new N(this.fov,this.aspectRatio,this.znear,this.zfar),this.clock=new B}start(){this.createScene(),this.mainLoop()}mainLoop(){this.update(this.clock.getDelta()),this.renderer.render(this.scene,this.camera),window.requestAnimationFrame(()=>this.mainLoop())}resize(){this.renderer.setSize(window.innerWidth,window.innerHeight);var e=new C;this.renderer.getViewport(e);var r=window.innerWidth/window.innerHeight;this.aspectRatio>r?this.renderer.setViewport(0,(window.innerHeight-window.innerWidth/this.aspectRatio)/2,window.innerWidth,window.innerWidth/this.aspectRatio):this.renderer.setViewport((window.innerWidth-window.innerHeight*this.aspectRatio)/2,0,window.innerHeight*this.aspectRatio,window.innerHeight)}onMouseDown(e){}onMouseUp(e){}onMouseMove(e){}onKeyDown(e){}onKeyUp(e){}}class y extends L{constructor(e,r,i,s){super();a(this,"startTime");a(this,"magnitude");a(this,"mapPosition");a(this,"globePosition");this.startTime=s,this.magnitude=i,this.mapPosition=e,this.globePosition=r,this.geometry=new H(1);var t=new T;t.color=new U(1,1-i,0),this.material=t,this.scale.set(.1,.1,.1),this.position.copy(this.mapPosition)}morphPosition(e){this.position.lerpVectors(this.mapPosition,this.globePosition,e)}}class _ extends F{constructor(){super();a(this,"earthMesh");a(this,"earthMaterialHighRes");a(this,"earthMaterialLowRes");a(this,"debugMaterial");a(this,"highResTexture");a(this,"mapVertices");a(this,"mapNormals");a(this,"globeVertices");a(this,"globeNormals");a(this,"globeMode");a(this,"alpha");a(this,"axialTilt");a(this,"earthRotation");a(this,"earthRotationBeforeMorph");this.earthMesh=new L,this.earthMaterialHighRes=new T,this.earthMaterialLowRes=new T,this.debugMaterial=new A,this.highResTexture=!0,this.mapVertices=[],this.mapNormals=[],this.globeVertices=[],this.globeNormals=[],this.globeMode=!1,this.alpha=0,this.axialTilt=0,this.earthRotation=new v,this.earthRotationBeforeMorph=new v}initialize(){this.earthMaterialLowRes.map=new k().load("./data/earth-1k.png"),this.earthMaterialHighRes.map=new k().load("./data/earth-2k.png"),this.earthMaterialHighRes.map.minFilter=W,this.highResTexture?this.earthMesh.material=this.earthMaterialHighRes:this.earthMesh.material=this.earthMaterialLowRes,this.debugMaterial.wireframe=!0;const e=200;for(let n=0;n<=e;n++)for(let o=0;o<=e;o++){var r=180*n/e-90,i=360*o/e-180,s=this.convertLatLongToPlane(r,i);this.mapVertices.push(s.x,s.y,s.z),this.mapNormals.push(0,0,1);var t=this.convertLatLongToSphere(r,i);this.globeVertices.push(t.x,t.y,t.z),t.normalize(),this.globeNormals.push(t.x,t.y,t.z)}this.earthMesh.geometry.setAttribute("position",new M(this.mapVertices,3)),this.earthMesh.geometry.setAttribute("normal",new M(this.mapNormals,3));var h=[];for(let n=0;n<e;n++)for(let o=0;o<e;o++)h.push((e+1)*n+o),h.push((e+1)*n+o+1),h.push((e+1)*(n+1)+o),h.push((e+1)*n+o+1),h.push((e+1)*(n+1)+(o+1)),h.push((e+1)*(n+1)+o);this.earthMesh.geometry.setIndex(h);var d=[];for(let n=0;n<=e;n++)for(let o=0;o<=e;o++)d.push(o/e),d.push(n/e);this.earthMesh.geometry.setAttribute("uv",new M(d,2));var p=new D;p.load("./data/height-2k.txt",n=>{var o=[],b=0,R=0;n.toString().split(`
`).forEach(g=>{g.split(" ").forEach(c=>{o.push(parseInt(c))}),R++}),b=o.length/R;for(let g=0;g<=e;g++)for(let c=0;c<=e;c++){var P=Math.floor(c/e*(b-1)),I=Math.floor((1-g/e)*(R-1)),S=o[I*b+P]/255-.5,m=(g*(e+1)+c)*3,w=new x(this.globeNormals[m],this.globeNormals[m+1],this.globeNormals[m+2]);w.multiplyScalar(S*.1),this.globeVertices[m]+=w.x,this.globeVertices[m+1]+=w.y,this.globeVertices[m+2]+=w.z}}),this.add(this.earthMesh)}update(e){const i=15*Math.PI/180,s=-23.4*Math.PI/180;this.globeMode?(this.alpha<1&&(this.alpha=Math.min(this.alpha+1*e,1),this.morphMesh(),this.axialTilt=u.lerp(0,s,this.alpha)),this.earthRotation.y+=i*e,this.earthRotation.x>Math.PI?this.earthRotation.x-=Math.PI*2:this.earthRotation.x<-Math.PI&&(this.earthRotation.x+=Math.PI*2),this.earthRotation.y>Math.PI?this.earthRotation.y-=Math.PI*2:this.earthRotation.y<-Math.PI&&(this.earthRotation.y+=Math.PI*2),this.earthRotationBeforeMorph.copy(this.earthRotation)):this.alpha>0&&(this.alpha=Math.max(this.alpha-1*e,0),this.morphMesh(),this.axialTilt=u.lerp(0,s,this.alpha),this.earthRotation.x=u.lerp(0,this.earthRotationBeforeMorph.x,this.alpha),this.earthRotation.y=u.lerp(0,this.earthRotationBeforeMorph.y,this.alpha));var t=new f().makeRotationZ(this.axialTilt),h=new f().makeRotationY(this.earthRotation.y),d=new f().makeRotationX(this.earthRotation.x),p=new f;p.multiply(d),p.multiply(t),p.multiply(h),this.setRotationFromMatrix(p)}morphMesh(){var e=[],r=[];for(let i=0;i<this.mapVertices.length;i++)e.push(u.lerp(this.mapVertices[i],this.globeVertices[i],this.alpha)),r.push(u.lerp(this.mapNormals[i],this.globeNormals[i],this.alpha));this.earthMesh.geometry.setAttribute("position",new M(e,3)),this.earthMesh.geometry.setAttribute("normal",new M(r,3)),this.rotation.z=u.lerp(0,-.4,this.alpha)}createEarthquake(e,r){var i=this.convertLatLongToPlane(e.latitude,e.longitude),s=this.convertLatLongToSphere(e.latitude,e.longitude),t=new y(i,s,r,e.date.getTime());this.add(t)}animateEarthquakes(e){this.children.forEach(i=>{if(i instanceof y){var s=u.clamp(Math.abs(e/1e3-i.startTime/1e3)/29030400,0,1);if(s<1){i.position.lerpVectors(i.mapPosition,i.globePosition,this.alpha);var t=.1+.9*i.magnitude;t*=1-s,t*=.1,i.scale.set(t,t,t)}else this.remove(i)}})}reset(){this.children.forEach(e=>{e instanceof y&&this.remove(e)})}toggleDebugMode(e){e?this.earthMesh.material=this.debugMaterial:this.highResTexture?this.earthMesh.material=this.earthMaterialHighRes:this.earthMesh.material=this.earthMaterialLowRes}convertLatLongToSphere(e,r){var i=e*Math.PI/180,s=r*Math.PI/180;return new x(Math.sin(s)*Math.cos(i),Math.sin(i),Math.cos(s)*Math.cos(i))}convertLatLongToPlane(e,r){return new x(r*Math.PI/180,e*Math.PI/180,0)}changeTextureResolution(e){this.highResTexture=e,this.earthMesh.material!=this.debugMaterial&&(this.highResTexture?this.earthMesh.material=this.earthMaterialHighRes:this.earthMesh.material=this.earthMaterialLowRes)}}class Y{constructor(e){a(this,"date");a(this,"longitude");a(this,"latitude");a(this,"magnitude");this.date=new Date,this.date.setUTCFullYear(parseInt(e.substring(12,16))),this.date.setUTCMonth(parseInt(e.substring(17,19))),this.date.setUTCDate(parseInt(e.substring(20,22))),this.date.setUTCHours(parseInt(e.substring(24,26))),this.date.setUTCMinutes(parseInt(e.substring(27,29))),this.date.setUTCSeconds(parseFloat(e.substring(30,35))),this.longitude=parseFloat(e.substring(44,52)),this.latitude=parseFloat(e.substring(37,44)),this.magnitude=parseFloat(e.substring(66,70))}}class j{constructor(e){a(this,"earthquakes");a(this,"loaded");a(this,"maxMagnitude");a(this,"minMagnitude");a(this,"nextIndex");this.earthquakes=[],this.loaded=!1,this.maxMagnitude=0,this.minMagnitude=1/0,this.nextIndex=0;var r=new D;r.load(e,i=>{var s=i.toString().split(`
`);s.forEach(t=>{if(t.length>30){var h=new Y(t);this.earthquakes.push(h),h.magnitude>this.maxMagnitude?this.maxMagnitude=h.magnitude:h.magnitude<this.minMagnitude&&(this.minMagnitude=h.magnitude)}}),this.loaded=!0})}reset(){this.nextIndex=0}getNextQuake(e){for(var r=e.getTime();this.nextIndex<this.earthquakes.length;)return this.earthquakes[this.nextIndex].date.getTime()<r?(this.nextIndex++,this.earthquakes[this.nextIndex-1]):null;return null}getMaxTime(){return this.earthquakes[this.earthquakes.length-1].date.getTime()}getMinTime(){return this.earthquakes[0].date.getTime()}}class X extends Q{constructor(){super(60,1920/1080,.1,50);a(this,"earth");a(this,"gui");a(this,"earthquakeDB");a(this,"currentTime");a(this,"mouseDrag");a(this,"mouseVector");a(this,"date");a(this,"viewMode");a(this,"playbackSpeed");a(this,"debugMode");this.gui=new G,this.earth=new _,this.earthquakeDB=new j("./data/earthquakes.txt"),this.currentTime=1/0,this.mouseDrag=!1,this.mouseVector=new v,this.date="",this.viewMode="Map",this.playbackSpeed=.5,this.debugMode=!1,this.resize()}createScene(){this.camera.position.set(0,0,3.25),this.camera.lookAt(0,0,0),this.camera.up.set(0,1,0);var e=new K("white",1.5);e.position.set(10,10,15),this.scene.add(e),this.scene.background=new k().load("./data/stars.png"),this.earth.initialize(),this.scene.add(this.earth);var r=this.gui.addFolder("Earthquake Controls"),i=r.add(this,"date");i.name("Current Date"),i.listen();var s=r.add(this,"viewMode",{Map:"Map",Globe:"Globe"});s.name("View Mode"),s.onChange(d=>{this.earth.globeMode=d=="Globe"});var t=r.add(this,"playbackSpeed",0,1);t.name("Playback Speed");var h=r.add(this,"debugMode");h.name("Debug Mode"),h.onChange(d=>{this.toggleDebugMode(d)}),this.gui.width=300,r.open()}update(e){if(!this.earthquakeDB.loaded)return;const r=3e10;this.currentTime+=r*this.playbackSpeed*e,this.currentTime>this.earthquakeDB.getMaxTime()&&(this.currentTime=this.earthquakeDB.getMinTime(),this.earthquakeDB.reset(),this.earth.reset());var i=new Date;i.setTime(this.currentTime),this.date=i.getUTCMonth()+"/"+i.getUTCDate()+"/"+i.getUTCFullYear();for(var s=this.earthquakeDB.getNextQuake(i);s;){var t=(s.magnitude-this.earthquakeDB.minMagnitude)/(this.earthquakeDB.maxMagnitude-this.earthquakeDB.minMagnitude);this.earth.createEarthquake(s,t),s=this.earthquakeDB.getNextQuake(i)}this.earth.update(e),this.earth.animateEarthquakes(this.currentTime)}toggleDebugMode(e){this.earth.toggleDebugMode(e)}onMouseDown(e){this.mouseDrag=!0}onMouseUp(e){this.mouseDrag=!1}onMouseMove(e){this.mouseDrag&&this.earth.globeMode&&(this.earth.earthRotation.x+=(e.y-this.mouseVector.y)*.5*Math.PI/180),this.mouseVector.set(e.x,e.y)}resize(){if(super.resize(),this.earth){var e=new v;this.renderer.getSize(e),this.earth.changeTextureResolution(e.width>1e3)}}}var Z=new X;Z.start();
